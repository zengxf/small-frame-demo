## Conv2d æµ‹è¯• - G2

### å‚è€ƒ

- https://chat.qwen.ai/c/1962f467-2adc-481b-918f-ec96a3a5be9a

### è¾“å‡ºè¯´æ˜

#### x3_1_2_3_3-in_2-out_2-gp_2-k_2_2-test.py

- ref: [test.py](x3_1_2_3_3-in_2-out_2-gp_2-k_2_2-test.py)
- æµ‹è¯• PyTorch Conv2dï¼š2 in, 2 out, 2 group, 2x2 kernel
- **è¯´æ˜ï¼šå¦‚ä¸‹**

##### 1. è¾“å…¥å¼ é‡ï¼ˆbatch=1, channel=2, H=3, W=3ï¼‰

```python
Input = [
    [  # Channel 0
        [1, 2, 3],
        [4, 5, 6],
        [7, 8, 9]
    ],
    [  # Channel 1
        [10, 11, 12],
        [13, 14, 15],
        [16, 17, 18]
    ]
]  # shape: (2, 3, 3)
```

åŠ ä¸Š batch ç»´åº¦åä¸º `(1, 2, 3, 3)`ã€‚

##### 2. Conv2d é…ç½®

- `in_channels = 2`
- `out_channels = 2`
- `groups = 2` â†’ æ¯ç»„å¤„ç† 1 ä¸ªè¾“å…¥é€šé“ï¼Œè¾“å‡º 1 ä¸ªé€šé“
- `kernel_size = 2`
- `stride = 1`, `padding = 0`ï¼ˆé»˜è®¤ï¼‰

##### 3. æƒé‡ï¼ˆç¡¬ç¼–ç ä¸ºç®€å•æ•´æ•°ï¼‰

ç”±äº `groups=2`ï¼Œæƒé‡å½¢çŠ¶ä¸º `(out_channels=2, in_channels_per_group=1, 2, 2)`ã€‚

æˆ‘ä»¬è®¾å®šï¼š

- **Group 0ï¼ˆå¤„ç† input channel 0 â†’ output channel 0ï¼‰** çš„å·ç§¯æ ¸ï¼š
  ```
  [[1, 0],
   [0, 1]]
  ```

- **Group 1ï¼ˆå¤„ç† input channel 1 â†’ output channel 1ï¼‰** çš„å·ç§¯æ ¸ï¼š
  ```
  [[0, 1],
   [1, 0]]
  ```

æ‰€ä»¥æ•´ä½“æƒé‡ä¸ºï¼š

```python
Weight = [
    [  # Output channel 0 (å¯¹åº” input channel 0)
        [[1, 0],
         [0, 1]]
    ],
    [  # Output channel 1 (å¯¹åº” input channel 1)
        [[0, 1],
         [1, 0]]
    ]
]  # shape: (2, 1, 2, 2)
```

> æ³¨æ„ï¼šæ¯ä¸ªè¾“å‡ºé€šé“åªâ€œçœ‹åˆ°â€è‡ªå·±å¯¹åº”çš„è¾“å…¥é€šé“ï¼ˆå› ä¸º groups=2ï¼‰ã€‚

---

##### ğŸ” åˆ†æ­¥è®¡ç®—

å·ç§¯åœ¨æ¯ä¸ª group å†…ç‹¬ç«‹è¿›è¡Œã€‚è¾“å‡ºç©ºé—´å¤§å° = `3 - 2 + 1 = 2`ï¼Œæ‰€ä»¥æ¯ä¸ªè¾“å‡ºé€šé“æ˜¯ `2x2`ã€‚

---

###### ğŸŸ¦ Group 0ï¼šInput Channel 0 â†’ Output Channel 0

**è¾“å…¥ï¼ˆChannel 0ï¼‰**:

```
[1, 2, 3]
[4, 5, 6]
[7, 8, 9]
```

**å·ç§¯æ ¸**:

```
[1, 0]
[0, 1]
```

æ»‘åŠ¨çª—å£ï¼ˆ2x2ï¼‰ï¼Œå…± 4 ä¸ªä½ç½®ï¼š

1. **Top-left (0,0)**:
   ```
   [1, 2]
   [4, 5]
   ```
   è®¡ç®—ï¼š`1*1 + 2*0 + 4*0 + 5*1 = 1 + 0 + 0 + 5 = 6`

2. **Top-right (0,1)**:
   ```
   [2, 3]
   [5, 6]
   ```
   è®¡ç®—ï¼š`2*1 + 3*0 + 5*0 + 6*1 = 2 + 0 + 0 + 6 = 8`

3. **Bottom-left (1,0)**:
   ```
   [4, 5]
   [7, 8]
   ```
   è®¡ç®—ï¼š`4*1 + 5*0 + 7*0 + 8*1 = 4 + 0 + 0 + 8 = 12`

4. **Bottom-right (1,1)**:
   ```
   [5, 6]
   [8, 9]
   ```
   è®¡ç®—ï¼š`5*1 + 6*0 + 8*0 + 9*1 = 5 + 0 + 0 + 9 = 14`

âœ… æ‰€ä»¥ **Output Channel 0** ä¸ºï¼š

```
[[ 6,  8],
 [12, 14]]
```

---

###### ğŸŸ¨ Group 1ï¼šInput Channel 1 â†’ Output Channel 1

**è¾“å…¥ï¼ˆChannel 1ï¼‰**:

```
[10, 11, 12]
[13, 14, 15]
[16, 17, 18]
```

**å·ç§¯æ ¸**:

```
[0, 1]
[1, 0]
```

æ»‘åŠ¨çª—å£ï¼š

1. **Top-left (0,0)**:
   ```
   [10, 11]
   [13, 14]
   ```
   è®¡ç®—ï¼š`10*0 + 11*1 + 13*1 + 14*0 = 0 + 11 + 13 + 0 = 24`

2. **Top-right (0,1)**:
   ```
   [11, 12]
   [14, 15]
   ```
   è®¡ç®—ï¼š`11*0 + 12*1 + 14*1 + 15*0 = 0 + 12 + 14 + 0 = 26`

3. **Bottom-left (1,0)**:
   ```
   [13, 14]
   [16, 17]
   ```
   è®¡ç®—ï¼š`13*0 + 14*1 + 16*1 + 17*0 = 0 + 14 + 16 + 0 = 30`

4. **Bottom-right (1,1)**:
   ```
   [14, 15]
   [17, 18]
   ```
   è®¡ç®—ï¼š`14*0 + 15*1 + 17*1 + 18*0 = 0 + 15 + 17 + 0 = 32`

âœ… æ‰€ä»¥ **Output Channel 1** ä¸ºï¼š

```
[[24, 26],
 [30, 32]]
```

---

##### ğŸ§¾ æœ€ç»ˆè¾“å‡ºå¼ é‡ï¼ˆbatch=1ï¼‰

åˆå¹¶ä¸¤ä¸ªè¾“å‡ºé€šé“ï¼š

```python
Output = [
    [  # Output channel 0
        [6, 8],
        [12, 14]
    ],
    [  # Output channel 1
        [24, 26],
        [30, 32]
    ]
]  # shape: (2, 2, 2)
```

åŠ ä¸Š batch ç»´åº¦ï¼š`(1, 2, 2, 2)`
